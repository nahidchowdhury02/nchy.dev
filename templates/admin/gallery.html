<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title>Gallery Ward</title><link rel="stylesheet" href="/static/styles.css" /></head>
<body><header><h1>Gallery Ward</h1></header><main>
{% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}{% for category, message in messages %}<p><strong>{{ category|upper }}</strong>: {{ message }}</p>{% endfor %}{% endif %}{% endwith %}
<nav><a href="{{ url_for('admin.manage') }}">Hall</a><a href="{{ url_for('admin.books') }}">Books</a><a href="{{ url_for('admin.gallery') }}">Gallery</a><a href="{{ url_for('admin.notes') }}">Notes</a><a href="/">Home</a><form method="post" action="{{ url_for('admin.logout') }}" style="display:inline-block; margin-left:8px;"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}" /><button type="submit">leave</button></form></nav>
<section><h2>Upload image</h2><form id="upload-form" method="post" action="{{ url_for('admin.gallery_upload') }}" enctype="multipart/form-data"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}" id="upload-csrf" /><input type="file" name="image" accept="image/*" required /><button type="submit">send</button></form><p id="upload-status"></p></section>
<section><h2>New item</h2><form method="post" action="{{ url_for('admin.gallery') }}"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
<p><label>Category</label><br /><select name="category"><option value="sketches">sketches</option><option value="moments">moments</option><option value="all">all</option></select></p>
<p><label>Title</label><br /><input type="text" name="title" required /></p>
<p><label>Caption</label><br /><textarea name="caption" rows="3" style="width:100%;"></textarea></p>
<p><label>Image URL</label><br /><input type="url" name="image_url" id="create-image-url" /></p>
<p><label>Cloudinary ID</label><br /><input type="text" name="cloudinary_public_id" id="create-public-id" /></p>
<p><label>Sort</label><br /><input type="number" name="sort_order" value="0" /></p>
<p><label><input type="checkbox" name="is_published" value="1" checked /> shown</label></p>
<button type="submit">forge</button></form></section>
<section><h2>Kept items</h2>{% for item in items %}<article style="border:1px solid #444; padding:1rem; margin-bottom:1rem; background:#fff;"><form method="post" action="{{ url_for('admin.gallery_update', item_id=item.id) }}"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}" /><p><label>Category</label><br /><select name="category"><option value="sketches" {% if item.category == 'sketches' %}selected{% endif %}>sketches</option><option value="moments" {% if item.category == 'moments' %}selected{% endif %}>moments</option><option value="all" {% if item.category == 'all' %}selected{% endif %}>all</option></select></p><p><label>Title</label><br /><input type="text" name="title" value="{{ item.title }}" required /></p><p><label>Caption</label><br /><textarea name="caption" rows="3" style="width:100%;">{{ item.caption }}</textarea></p><p><label>Image URL</label><br /><input type="url" name="image_url" value="{{ item.image_url }}" /></p><p><label>Cloudinary ID</label><br /><input type="text" name="cloudinary_public_id" value="{{ item.cloudinary_public_id }}" /></p><p><label>Sort</label><br /><input type="number" name="sort_order" value="{{ item.sort_order }}" /></p><p><label><input type="checkbox" name="is_published" value="1" {% if item.is_published %}checked{% endif %} /> shown</label></p><button type="submit">save</button></form><form method="post" action="{{ url_for('admin.gallery_delete', item_id=item.id) }}" onsubmit="return confirm('Remove this item?');"><input type="hidden" name="csrf_token" value="{{ csrf_token() }}" /><button type="submit">remove</button></form></article>{% else %}<p>none yet.</p>{% endfor %}</section>
</main><script>(function () {const uploadForm = document.getElementById("upload-form");const status = document.getElementById("upload-status");const imageUrlInput = document.getElementById("create-image-url");const publicIdInput = document.getElementById("create-public-id");if (!uploadForm) {return;}uploadForm.addEventListener("submit", async function (event) {event.preventDefault();status.textContent = "sending...";try {const formData = new FormData(uploadForm);const response = await fetch(uploadForm.action, {method: "POST",body: formData,});const data = await response.json();if (!response.ok) {status.textContent = data.error || "failed";return;}imageUrlInput.value = data.image_url || "";publicIdInput.value = data.cloudinary_public_id || "";status.textContent = "done. fields filled.";} catch (error) {status.textContent = "failed.";}});})();</script></body></html>
