<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>INCXCNI</title>
  <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
  <header>
    <h1>QUIET STACK OF N</h1>
  </header>

  <main>
    <div class="notice-banner" role="status" id="notice-banner">
      <span>wayfarer, this house is half built.</span>
      <button class="notice-dismiss" id="notice-dismiss" type="button">aye</button>
    </div>
    <section class="hero-shelves">
      <div class="dev-box">
        <div class="dev-box-header">
          <span class="dev-box-title">The Library</span>
          <span class="dev-box-subtitle">old volumes and marginalia.</span>
        </div>
        <div class="dev-box-previews" id="dev-previews"></div>
      </div>
      <div class="link-grid">
        <article>
          <h3>Github &amp; Research</h3>
          <p>fragments and proofs.</p>
          <a href="/github-research">view</a>
        </article>
        <article>
          <h3>Gallery</h3>
          <p>sketches and remnants.</p>
          <a href="/gallery">view</a>
        </article>
        <article>
          <h3>Music list</h3>
          <p>night songs.</p>
          <a href="/music">listen</a>
        </article>
        <article>
          <h3>Reading List</h3>
          <p>books in hand.</p>
          <a href="/reading">open</a>
        </article>
        <article>
          <h3>Fun Stuff</h3>
          <p>odd little trials.</p>
          <a href="/fun">try</a>
        </article>
        <article>
          <h3>Notes &amp; Logs</h3>
          <p>ledger and whisper.</p>
          <a href="/notes">read</a>
        </article>
        <article>
          <h3>eh</h3>
          <p>if you must write.</p>
          <a href="/contact">email</a>
        </article>
      </div>
    </section>
  </main>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dismiss = document.getElementById("notice-dismiss");
      const banner = document.getElementById("notice-banner");
      if (dismiss && banner) {
        dismiss.addEventListener("click", function () {
          banner.remove();
        });
      }

      const previews = document.getElementById("dev-previews");
      const fallbackBooks = {{ preview_books|tojson }};

      function renderBooks(books) {
        previews.innerHTML = "";
        books.forEach((book) => {
          const title = book.title || book.original_title || "Untitled";
          const cover = book.cover_url || "/static/images/gallery-sketches.png";
          const preview = document.createElement("div");
          preview.className = "preview-card";
          preview.innerHTML = `<img src="${cover}" alt="${title}">`;
          previews.appendChild(preview);
        });
      }

      fetch("/api/books?limit=8")
        .then(response => response.json())
        .then(payload => {
          renderBooks(payload.items || []);
        })
        .catch(() => {
          renderBooks(fallbackBooks || []);
        });
    });
  </script>

  <footer>Kept, not hurried.</footer>
</body>
</html>
