{% extends "layouts/public.html" %}

{% block title %}INCXCNI{% endblock %}
{% block header_title %}Quiet Stack of N{% endblock %}

{% block content %}
  <div class="notice-banner card" role="status" id="notice-banner">
    <span>Wayfarer, this house is half built.</span>
    <button class="notice-dismiss" id="notice-dismiss" type="button">aye</button>
  </div>

  <section class="hero-shelves">
    <section class="card library-panel">
      <div class="library-panel-head">
        <h2>The Library</h2>
        <p>Old volumes and marginalia.</p>
      </div>
      <div class="preview-grid" id="dev-previews"></div>
    </section>

    <section>
      <h2 class="section-title">Explore</h2>
      <div class="card-grid link-grid">
        <article class="card">
          <h3>Github and Research</h3>
          <p>Fragments and proofs.</p>
          <a class="btn-link" href="{{ url_for('main.github_research') }}">view</a>
        </article>
        <article class="card">
          <h3>Gallery</h3>
          <p>Sketches and remnants.</p>
          <a class="btn-link" href="{{ url_for('main.gallery') }}">view</a>
        </article>
        <article class="card">
          <h3>Music List</h3>
          <p>Night songs.</p>
          <a class="btn-link" href="{{ url_for('main.music') }}">listen</a>
        </article>
        <article class="card">
          <h3>Reading List</h3>
          <p>Books in hand.</p>
          <a class="btn-link" href="{{ url_for('main.reading') }}">open</a>
        </article>
        <article class="card">
          <h3>Fun Stuff</h3>
          <p>Odd little trials.</p>
          <a class="btn-link" href="{{ url_for('main.fun') }}">try</a>
        </article>
        <article class="card">
          <h3>Notes and Logs</h3>
          <p>Ledger and whisper.</p>
          <a class="btn-link" href="{{ url_for('main.notes') }}">read</a>
        </article>
        <article class="card">
          <h3>Contact</h3>
          <p>If you must write.</p>
          <a class="btn-link" href="{{ url_for('main.contact') }}">email</a>
        </article>
      </div>
    </section>
  </section>
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dismiss = document.getElementById("notice-dismiss");
      const banner = document.getElementById("notice-banner");
      if (dismiss && banner) {
        dismiss.addEventListener("click", function () {
          banner.remove();
        });
      }

      const previews = document.getElementById("dev-previews");
      const fallbackBooks = {{ preview_books|tojson }};

      function renderBooks(books) {
        if (!previews) {
          return;
        }
        previews.innerHTML = "";

        books.forEach((book) => {
          const title = book.title || book.original_title || "Untitled";
          const cover = book.cover_url || "/static/images/gallery-sketches.png";
          const preview = document.createElement("div");
          preview.className = "preview-card";
          preview.innerHTML = `<img src="${cover}" alt="${title}">`;
          previews.appendChild(preview);
        });
      }

      fetch("/api/books?limit=8")
        .then((response) => response.json())
        .then((payload) => {
          renderBooks(payload.items || []);
        })
        .catch(() => {
          renderBooks(fallbackBooks || []);
        });
    });
  </script>
{% endblock %}