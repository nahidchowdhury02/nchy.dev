{% extends "layouts/public.html" %}

{% block title %}Books{% endblock %}
{% block header_title %}Books{% endblock %}

{% block content %}
  <section class="card intro-card">
    <form method="get" action="{{ url_for('main.books') }}" class="inline-form">
      <input type="search" name="q" value="{{ query or '' }}" placeholder="Search by title or author" aria-label="Search books" />
      <button type="submit">Search</button>
    </form>
    <p>{{ total_books }} total books. Page {{ page }} of {{ total_pages }}.</p>
  </section>

  <section class="card-grid" aria-label="Books library list">
    {% for book in books %}
      <article class="card book-card">
        <figure class="preview-card">
          <img src="{{ book.cover_url or url_for('static', filename='images/missing book cover.png') }}" alt="cover of {{ book.title or book.original_title }}" loading="lazy" />
        </figure>

        <h3>{{ book.title or book.original_title }}</h3>
        <p class="book-meta">{{ (book.authors or [])|join(', ') or 'unknown author' }}</p>
        <p class="book-meta">{{ book.first_publish_year or 'year unknown' }}</p>

        {% if book.description %}
          <p>{{ book.description[:220] }}{% if book.description|length > 220 %}...{% endif %}</p>
        {% endif %}
      </article>
    {% else %}
      <article class="card"><p>no books yet.</p></article>
    {% endfor %}
  </section>

  {% if total_pages > 1 %}
    <section class="card">
      <div class="inline-actions" aria-label="Books pagination">
        {% if has_prev %}
          <a class="btn-link" href="{{ url_for('main.books', page=page-1, q=query) }}">previous</a>
        {% endif %}
        <span class="small-note">page {{ page }} / {{ total_pages }}</span>
        {% if has_next %}
          <a class="btn-link" href="{{ url_for('main.books', page=page+1, q=query) }}">next</a>
        {% endif %}
      </div>
    </section>
  {% endif %}
{% endblock %}
